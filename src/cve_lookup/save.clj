(ns cve-lookup.save
  (:require [clojure.data.json :as json]
            [cve-lookup.db.repository :as repo]
            [cve-lookup.db.database :as db]
            [clj-postgresql.types :as tp]))


(def nvd-nist-gov "https://nvd.nist.gov/vuln/data-feeds#JSON_FEED")
(def dir "/Users/andriishevchun/Test_projects/cve_lookup/resources/downloads/nvdcve-1.1-recent.json")

(defn insert-into-db
[line]
  (repo/insert-look-up db/dbspec {:meta_file (tp/map->parameter line :json)}))

(defn read-file
  []
  (doseq [link  (get-in (json/read-str (slurp dir) :key-fn keyword) [:CVE_Items])]
    (println link)))

;(defn insert-into-db
;  []
  ;(repo/insert-look-up db/dbspec {:meta_file (tp/map->parameter (json/read-str "{\"a\":1,\"b\":2}"
 ;                                            :key-fn keyword) :json)})
 ; (println  (tp/map->parameter (json/read-str "{\"a\":1,\"b\":2}"
 ;                                             :key-fn keyword) :json))
;  )