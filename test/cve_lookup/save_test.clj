(ns cve-lookup.save-test
  (:require [clojure.test :refer :all]
            [cve-lookup.save :refer :all]
            [cve-lookup.clj.fixtures :as f]
            [clojure.java.jdbc :as jdbc]
            [cve-lookup.resources.config :as c]))

(use-fixtures :once
              (join-fixtures [f/with-embedded-postgres
                              f/with-migration]))

(deftest read-and-save-file-test
  (testing "Test read and inserting into DB"
    (jdbc/with-db-connection [db c/test-dbspec]
                             (read-and-save-file "test/cve_lookup/resources/test.json" db)
                             (is (= '({:id "CVE-2006-7777"})
                                    (jdbc/query db "select id from cve_look_up where id = 'CVE-2006-7777'"))))))